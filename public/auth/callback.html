<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auth Callback</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body{margin:0;background:#0b0b0b;color:#fff;font:15px system-ui;display:grid;place-items:center;height:100vh}
    .box{opacity:.9;text-align:center}
  </style>
</head>
<body>
  <div class="box" id="msg">Finishing sign-inâ€¦</div>

  <script>
    const { createClient } = supabase;

    // YOUR Supabase project URL + anon key
    const SUPABASE_URL = 'https://rlejpxhkftihlkchklwub.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsZWpweGhrZnRpaGxjaGtsd3ViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxMDUyMDIsImV4cCI6MjA3MjY4MTIwMn0.CBunws9Ge-zi858JS7LBen6fTYV_0fZ1__D2VdjTDtM';
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Where to send the user after we finish (default to home if missing)
    const url  = new URL(location.href);
    const next = url.searchParams.get('next') || '/';

    async function finish() {
      const href = location.href;
      const code = url.searchParams.get('code');
      try {
        if (code) {
          // PKCE path (?code=...)
          const { error } = await sb.auth.exchangeCodeForSession(code);
          if (error) throw error;
        } else if (href.includes('#access_token=')) {
          // Hash fragment path (#access_token=...)
          const { data: { session } } = await sb.auth.getSession();
          if (!session) throw new Error('No session from hash.');
        } // else: direct visit, just continue

        // Clean URL (optional), then forward
        history.replaceState({}, '', '/auth/callback');
        location.replace(next);
      } catch (e) {
        document.getElementById('msg').textContent = 'Auth error: ' + (e?.message || e);
        console.error(e);
      }
    }
    finish();
  </script>
</body>
</html>
