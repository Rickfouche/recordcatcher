<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Record â€” GLB Viewer (AR)</title>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{margin:0;height:100%;background:#111;display:grid;place-items:center}
    .wrap{width:100vw;max-width:640px;display:grid;gap:14px;justify-items:center}
    model-viewer{width:100%;height:70vh;background:#000;border-radius:12px}
    #launch-ar{
      font:700 16px system-ui;padding:14px 28px;border-radius:999px;
      background:#ff3b30;color:#fff;border:none;box-shadow:0 10px 24px rgba(0,0,0,.35);
      cursor:pointer;transition:transform .08s ease,opacity .2s ease;
    }
    #launch-ar:hover{transform:translateY(-1px)}
    #launch-ar:active{transform:translateY(0)}
    #launch-ar[disabled]{opacity:.45;cursor:not-allowed;box-shadow:none}
    .hint{color:#aaa;font:500 12px/1.4 system-ui;text-align:center;opacity:.9}
  </style>
</head>
<body>
  <div class="wrap">
    <model-viewer id="mv"
      src=""  <!-- set via JS with cache-buster -->
      ar ar-modes="webxr scene-viewer"   <!-- no Quick Look / USDZ -->
      ar-scale="fixed" ar-placement="floor"
      camera-controls interaction-prompt="auto"
      auto-rotate shadow-intensity="1" environment-image="neutral">
    </model-viewer>

    <button id="launch-ar">Place in AR</button>
    <div class="hint" id="ar-hint"></div>
  </div>

  <script>
    const GLB_URL = "https://recordcatcher.b-cdn.net/glb/Recdemo.glb"; // your GLB

    const mv = document.getElementById('mv');
    const btn = document.getElementById('launch-ar');
    const hint = document.getElementById('ar-hint');

    // Set GLB with cache-buster
    mv.src = GLB_URL + (GLB_URL.includes('?') ? '&' : '?') + 'v=' + Date.now();

    function refreshARState(){
      const supported = mv.canActivateAR;
      btn.disabled = !supported;
      const ua = navigator.userAgent;
      if (supported) {
        hint.textContent = 'Tip: pinch to zoom & drag to spin before placing.';
      } else {
        // With no ios-src (USDZ), iOS Quick Look is unavailable.
        if (/iPhone|iPad|iPod/.test(ua)) {
          hint.textContent = 'AR not available here without USDZ. Try a WebXR-capable browser/device or add ios-src later.';
        } else if (/Android/.test(ua)) {
          hint.textContent = 'Requires Chrome + ARCore (Scene Viewer) for AR; otherwise you can interact in 3D above.';
        } else {
          hint.textContent = 'AR not available on this device. Try on a WebXR/ARCore-capable phone.';
        }
      }
    }

    btn.addEventListener('click', async () => {
      try { await mv.activateAR(); } catch(e){ console.warn('AR launch error:', e); }
    });

    mv.addEventListener('load', refreshARState);
    mv.addEventListener('ar-status', refreshARState);
    refreshARState();

    // Optional: basic error log
    mv.addEventListener('error', (e) => console.warn('model-viewer error:', e));
  </script>
</body>
</html>
