<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Universal GLB Viewer</title>
  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff}
    #c{width:100%;height:100%;display:block}
    #hud{position:fixed;left:0;right:0;top:0;padding:8px 12px;
         font:13px system-ui;background:rgba(0,0,0,.6)}
  </style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud">Boot…</div>
<script type="module">
import * as THREE from 'https://unpkg.com/three@0.161.0/build/three.module.js';
import {OrbitControls} from 'https://unpkg.com/three@0.161.0/examples/jsm/controls/OrbitControls.js';
import {GLTFLoader} from 'https://unpkg.com/three@0.161.0/examples/jsm/loaders/GLTFLoader.js';
import {DRACOLoader} from 'https://unpkg.com/three@0.161.0/examples/jsm/loaders/DRACOLoader.js';
import {KTX2Loader} from 'https://unpkg.com/three@0.161.0/examples/jsm/loaders/KTX2Loader.js';
import {MeshoptDecoder} from 'https://unpkg.com/meshoptimizer/meshopt_decoder.module.js';

const hud = document.getElementById('hud');
const url = prompt('Paste GLB/GLTF URL', 'https://recordcatcher.b-cdn.net/glb/Recdemo.glb?v=' + Date.now());
if(!url){ hud.textContent = 'No URL provided.'; throw new Error('no url'); }

const renderer = new THREE.WebGLRenderer({canvas: c, antialias:true});
renderer.setPixelRatio(devicePixelRatio); renderer.setSize(innerWidth, innerHeight);
renderer.outputColorSpace = THREE.SRGBColorSpace;

const scene = new THREE.Scene(); scene.background = new THREE.Color(0x000000);
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.01, 1000);
camera.position.set(0, 1.5, 3);
new OrbitControls(camera, renderer.domElement);

scene.add(new THREE.HemisphereLight(0xffffff, 0x222233, 1.0));
const dir = new THREE.DirectionalLight(0xffffff, 1.0); dir.position.set(2,3,2); scene.add(dir);

const loader = new GLTFLoader();

// DRACO
const draco = new DRACOLoader();
draco.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
loader.setDRACOLoader(draco);

// KTX2 (BasisU)
const ktx2 = new KTX2Loader().setTranscoderPath('https://storage.googleapis.com/gltf-tmp/');
ktx2.detectSupport(renderer);
loader.setKTX2Loader(ktx2);

// Meshopt
loader.setMeshoptDecoder(MeshoptDecoder);

hud.textContent = 'Fetching…';
loader.load(url,
  (gltf) => {
    hud.textContent = 'Loaded ✅';
    const root = gltf.scene;
    scene.add(root);

    // Frame model
    const box = new THREE.Box3().setFromObject(root);
    const size = box.getSize(new THREE.Vector3()).length();
    const center = box.getCenter(new THREE.Vector3());
    root.position.sub(center);
    camera.position.set(0, size*0.5, size*1.2);
    camera.lookAt(0,0,0);

    animate();
  },
  (xhr) => {
    const pct = xhr.total ? (xhr.loaded/xhr.total*100).toFixed(1) : ((xhr.loaded/1024)|0) + 'KB';
    hud.textContent = 'Loading… ' + pct;
  },
  (err) => {
    console.error('GLB load error:', err);
    hud.textContent = '❌ Load error. See console.';
  }
);

function animate(){ requestAnimationFrame(animate); renderer.render(scene, camera); }
addEventListener('resize', ()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
</script>
</body>
</html>
